<?xml version="1.0" standalone="yes"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<html><head>
<meta name='viewport' content="width=device-width, maximum-scale=2.0, minimum-scale=0.1, user-scalable=0"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head><body style="background-color:#fff">
<svg id='svg' width='1056px' height='1718px' version='1.1' xmlns='http://www.w3.org/2000/svg' style='visibility:hidden'>
<g id="rateNoteGroup"></g>
<g id="myCanvas"></g>
<g id="tempgroup"></g><rect id='cursor0'></rect><rect id='cursor1'></rect><rect id='cursor2'></rect><rect id='cursor3'></rect><rect id='cursor4'></rect><rect id='cursor5'></rect><rect id='cursor6'></rect><rect id='cursor7'></rect><rect id='cursor8'></rect><rect id='cursor9'></rect><rect id='progressBar'></rect><rect id='playloopA'></rect><rect id='playloopB'></rect><g id='wuxianpu'><g id='page_title' transform ="translate(0, 0.0)">
<g id='main_title' transform ="translate(0, 0.0)">
<text x='528' y='69' font-size='46' text-anchor="middle" fill='black'>请 弹 吧</text>
</g>
</g>
<g id='line_0' transform ="translate(0, 106.4)">
<path d='M646 6q0 -167 -168 -246l45 -188l1 -49q0 -81 -46.5 -131.5t-133.5 -59.5q-6 -1 -19 -1q-56 0 -109 36q-34 23 -52 51t-18 65q-1 7 -1 11q0 39 25 77q16 22 35.5 34t43.5 12q6 1 10 1q33 0 62 -27q35 -32 35 -75q0 -20 -4 -34q-7 -26 -30 -45q-30 -24 -63 -24l-11 1 q0 -23 37 -38q9 -4 23.5 -7t23.5 -3q7 1 11 1q147 15 147 159q0 39 -9 78l-36 141q-54 -14 -98 -14q-134 0 -236 102q-52 54 -81 116.5t-29 136.5q0 72 20 141t65.5 133.5t194.5 219.5q-32 125 -32 234q0 47 8 92t27 96q42 117 113 144q30 12 75 -105.5t45 -208.5 q0 -106 -49 -215q-45 -100 -124 -179l35 -179l42 2q100 0 162.5 -74.5t62.5 -180.5zM473 920q0 29 -17 50q-15 21 -43 21q-57 -12 -93 -103q-15 -40 -22.5 -74.5t-7.5 -72.5q0 -55 21 -132q70 58 115 138q25 43 36 85t11 88zM579 -30q0 36 -14.5 66t-41.5 55q-48 47 -122 47 l72 -348q48 25 80 76q14 22 20 48.5t6 55.5zM440 -222l-71 357q-44 -15 -76 -57t-32 -88q0 -72 83 -118q6 0 6 -9q0 -14 -15 -12q-60 21 -97.5 77t-37.5 120q0 65 42.5 123.5t103.5 80.5l-31 158q-110 -98 -161 -167q-77 -108 -77 -215q0 -121 89 -195q40 -33 91.5 -49.5 t111.5 -16.5q32 0 71 11z' fill='black' transform='translate(51.0,34.5) scale(-0.045, 0.045) rotate(180)'/><line x1='46.0' x2='999.0' y1='0.0' y2='0.0' stroke='black' />
<line x1='46.0' x2='999.0' y1='11.5' y2='11.5' stroke='black' />
<line x1='46.0' x2='999.0' y1='23.0' y2='23.0' stroke='black' />
<line x1='46.0' x2='999.0' y1='34.5' y2='34.5' stroke='black' />
<line x1='46.0' x2='999.0' y1='46.0' y2='46.0' stroke='black' />
<path d='M675 110q0 -21 -15 -39q-16 -16 -39 -16q-24 0 -39.5 16.5t-15.5 38.5q0 20 15 38q8 8 17 12t23 4q25 0 39 -17q15 -15 15 -37zM675 -109q0 -20 -15 -37.5t-39 -17.5t-39.5 16t-15.5 39q0 20 15 38q8 8 17 12t23 4q24 0 39 -16.5t15 -37.5zM524 5q0 -88 -54 -190.5 t-128 -163.5q-112 -91 -352 -209l-6 21q79 52 125 85q52 36 70 52q85 71 143 173q64 113 64 226q0 89 -24 136q-18 36 -55 57q-19 11 -39.5 15t-46.5 4q-85 -7 -118 -43t-33 -57q0 -24 26 -24l20 4l20 5q21 0 36 -4.5t30 -16.5q29 -24 29 -60q0 -33 -27 -62 q-16 -14 -33.5 -21t-40.5 -7q-48 0 -84 30.5t-36 76.5q0 50 28.5 95.5t75.5 73.5q24 15 71 27.5t69 12.5q108 0 181 -61q47 -38 68 -77t21 -98z' fill='black' transform='translate(51.0,160.5) scale(-0.045, 0.045) rotate(180)'/><line x1='46.0' x2='999.0' y1='149.0' y2='149.0' stroke='black' />
<line x1='46.0' x2='999.0' y1='160.5' y2='160.5' stroke='black' />
<line x1='46.0' x2='999.0' y1='172.0' y2='172.0' stroke='black' />
<line x1='46.0' x2='999.0' y1='183.5' y2='183.5' stroke='black' />
<line x1='46.0' x2='999.0' y1='195.0' y2='195.0' stroke='black' />
<path d='M421 -52q0 -42 -15.5 -78.5t-42.5 -65.5q-55 -58 -142 -58q-44 0 -92.5 26.5t-76.5 64.5q-52 70 -52 173q0 104 80 181q67 64 152 64q69 0 124 -37q62 -42 62 -109q0 -34 -23 -63t-61 -29q-33 0 -57.5 20t-24.5 53q0 54 65 78l15 3q9 2 12 8q1 9 -9 19q-14 13 -28.5 19 t-35.5 6q-11 1 -15 1q-59 0 -93.5 -46.5t-34.5 -159.5v-82q0 -49 17 -86q30 -69 97 -69q32 0 58.5 12t48.5 40q32 41 46 115h26z' fill='black' transform='translate(120.8,23.0) scale(-0.045, 0.045) rotate(180)'/><path d='M421 -52q0 -42 -15.5 -78.5t-42.5 -65.5q-55 -58 -142 -58q-44 0 -92.5 26.5t-76.5 64.5q-52 70 -52 173q0 104 80 181q67 64 152 64q69 0 124 -37q62 -42 62 -109q0 -34 -23 -63t-61 -29q-33 0 -57.5 20t-24.5 53q0 54 65 78l15 3q9 2 12 8q1 9 -9 19q-14 13 -28.5 19 t-35.5 6q-11 1 -15 1q-59 0 -93.5 -46.5t-34.5 -159.5v-82q0 -49 17 -86q30 -69 97 -69q32 0 58.5 12t48.5 40q32 41 46 115h26z' fill='black' transform='translate(120.8,172.0) scale(-0.045, 0.045) rotate(180)'/><path stroke='black' stroke-width='0.5' d='M5.25,147.193c-0.24-7.15,0.685-14.153,1.633-21.169c0.898-6.642,1.897-13.29,2.368-19.987c0.588-8.364-1.47-15.642-7.212-20.834C1.968,85.139,1.941,85,1.877,84.859c0.28-0.276,0.533-0.528,0.787-0.777c3.551-3.498,5.676-7.998,6.368-13.546C9.719,65.025,9.131,59.597,8.43,54.17c-1.021-7.896-2.264-15.76-2.995-23.696C4.629,21.723,5.482,13.13,8.772,5.138C9.422,3.559,9.603,2.035,9.338,0C9.16,0.346,9.104,0.454,9.049,0.563C1.763,14.979-1.077,30.265,3.006,46.936c1.2,4.899,2.391,9.807,3.445,14.756c1.833,8.603,0.066,15.988-5.222,22.071C0.913,84.125,0.558,84.439,0,84.997c0.477,0.419,0.796,0.642,1.058,0.94c5.147,5.86,7.227,12.978,5.515,21.455c-1.073,5.311-2.437,10.533-3.62,15.812c-1.568,6.994-2.294,14.082-1.516,21.346c0.938,8.762,3.664,16.687,7.324,24.19c0.158,0.322,0.338,0.629,0.594,1.104c0.208-1.895,0.118-3.409-0.548-5.001C6.496,159.325,5.458,153.38,5.25,147.193z' fill='black' transform='translate(34.5,0.0) scale(1,1.159)'/><line x1='46.0' x2='46.0' y1='0.0' y2='195.0' stroke='black' />
<text x='46' y='-27' font-size='18' fill='black'>1</text>
<path id='ID' d='M412 0q0 -67 -74 -100q-58 -26 -129 -26q-74 0 -131 25q-78 34 -78 101q0 65 74 100q58 26 128 26q72 0 131 -25q79 -34 79 -101zM287 -22q0 30 -8.5 53t-27.5 44q-14 17 -32 24t-41 7q-14 0 -24.5 -6t-19.5 -18.5t-9 -58.5q0 -56 35 -97q29 -33 61 -33q6 1 9 1 q33 5 45 22.5t12 61.5z' fill='black' transform='translate(155.2,57.7) scale(-0.045, 0.045) rotate(180)'/><line x1='150.6' x2='178.2' y1='57.5' y2='57.5' stroke='black' />
<path d='M250 -209h-209v31q32 0 43 17q8 13 8 47v209l-68 -108l-24 10l91 212h108v-323q0 -34 9 -47.5t42 -16.5v-31z' fill='black' transform='translate(155.2,85.1) scale(-0.027, 0.027) rotate(180)'/><line x1='355.2' x2='355.2' y1='0.0' y2='195.0' stroke='black' />
<rect id='m0' x='138' y='-23' width='217' height='241' style='fill: rgba(200, 200, 210, 0);'  />
<path id='ID' d='M412 0q0 -67 -74 -100q-58 -26 -129 -26q-74 0 -131 25q-78 34 -78 101q0 65 74 100q58 26 128 26q72 0 131 -25q79 -34 79 -101zM287 -22q0 30 -8.5 53t-27.5 44q-14 17 -32 24t-41 7q-14 0 -24.5 -6t-19.5 -18.5t-9 -58.5q0 -56 35 -97q29 -33 61 -33q6 1 9 1 q33 5 45 22.5t12 61.5z' fill='black' transform='translate(372.4,57.7) scale(-0.045, 0.045) rotate(180)'/><line x1='367.8' x2='395.4' y1='57.5' y2='57.5' stroke='black' />
<line x1='567.2' x2='567.2' y1='0.0' y2='195.0' stroke='black' />
<rect id='m1' x='355' y='-23' width='212' height='241' style='fill: rgba(200, 200, 210, 0);'  />
<path id='ID' d='M412 0q0 -67 -74 -100q-58 -26 -129 -26q-74 0 -131 25q-78 34 -78 101q0 65 74 100q58 26 128 26q72 0 131 -25q79 -34 79 -101zM287 -22q0 30 -8.5 53t-27.5 44q-14 17 -32 24t-41 7q-14 0 -24.5 -6t-19.5 -18.5t-9 -58.5q0 -56 35 -97q29 -33 61 -33q6 1 9 1 q33 5 45 22.5t12 61.5z' fill='black' transform='translate(584.5,57.7) scale(-0.045, 0.045) rotate(180)'/><line x1='579.9' x2='607.5' y1='57.5' y2='57.5' stroke='black' />
<line x1='779.2' x2='779.2' y1='0.0' y2='195.0' stroke='black' />
<rect id='m2' x='567' y='-23' width='212' height='241' style='fill: rgba(200, 200, 210, 0);'  />
<path id='ID' d='M412 0q0 -67 -74 -100q-58 -26 -129 -26q-74 0 -131 25q-78 34 -78 101q0 65 74 100q58 26 128 26q72 0 131 -25q79 -34 79 -101zM287 -22q0 30 -8.5 53t-27.5 44q-14 17 -32 24t-41 7q-14 0 -24.5 -6t-19.5 -18.5t-9 -58.5q0 -56 35 -97q29 -33 61 -33q6 1 9 1 q33 5 45 22.5t12 61.5z' fill='black' transform='translate(796.5,57.7) scale(-0.045, 0.045) rotate(180)'/><line x1='791.9' x2='819.5' y1='57.5' y2='57.5' stroke='black' />
<line x1='993.0' x2='993.0' y1='0.0' y2='195.0' stroke='black' />
<line x1='997.5' x2='997.5' y1='0.0' y2='195.0' stroke='black' stroke-width='3.0' />
<rect id='m3' x='779' y='-23' width='219' height='241' style='fill: rgba(200, 200, 210, 0);'  />
</g>
</g><g id='jianpu' style='visibility:hidden'>
<text x='528' y='69' font-size='46' fill='black' text-anchor="middle">请 弹 吧</text>
<g id='JianpuLine_0' transform ="translate(0, 106.4)">
<text x='23' y='2' font-size='36' fill='black'>1=C</text>
<text x='97' y='2' font-size='36' fill='black'>4/4</text>
<line x1='355.0' x2='355.0' y1='0.0' y2='195.0' stroke='black' stroke-width='1' />
<text x='152' y='42' font-size='37' fill='black'>1</text>
<line x1='203.0' x2='217.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='251.0' x2='265.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='299.0' x2='313.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='567.0' x2='567.0' y1='0.0' y2='195.0' stroke='black' stroke-width='1' />
<text x='369' y='42' font-size='37' fill='black'>1</text>
<line x1='419.0' x2='433.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='466.0' x2='480.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='513.0' x2='527.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='779.0' x2='779.0' y1='0.0' y2='195.0' stroke='black' stroke-width='1' />
<text x='581' y='42' font-size='37' fill='black'>1</text>
<line x1='631.0' x2='645.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='678.0' x2='692.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='725.0' x2='739.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='999.0' x2='999.0' y1='0.0' y2='195.0' stroke='black' stroke-width='1' />
<line x1='1003.0' x2='1003.0' y1='0.0' y2='195.0' stroke='black' stroke-width='3' />
<text x='793' y='42' font-size='37' fill='black'>1</text>
<line x1='845.0' x2='859.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='894.0' x2='908.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='943.0' x2='957.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
</g>
</g>
<g id='jianpufixdo' style='visibility:hidden'>
<text x='528' y='69' font-size='46' fill='black'>请 弹 吧</text>
<g id='JianpuFixDoLine_0' transform ="translate(0, 106.4)">
<text x='23' y='2' font-size='36' fill='black'>1=C</text>
<text x='97' y='2' font-size='36' fill='black'>4/4</text>
<line x1='355.0' x2='355.0' y1='0.0' y2='195.0' stroke='black' stroke-width='1' />
<text x='152' y='42' font-size='37' fill='black'>1</text>
<line x1='203.0' x2='217.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='251.0' x2='265.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='299.0' x2='313.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='567.0' x2='567.0' y1='0.0' y2='195.0' stroke='black' stroke-width='1' />
<text x='369' y='42' font-size='37' fill='black'>1</text>
<line x1='419.0' x2='433.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='466.0' x2='480.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='513.0' x2='527.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='779.0' x2='779.0' y1='0.0' y2='195.0' stroke='black' stroke-width='1' />
<text x='581' y='42' font-size='37' fill='black'>1</text>
<line x1='631.0' x2='645.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='678.0' x2='692.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='725.0' x2='739.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='999.0' x2='999.0' y1='0.0' y2='195.0' stroke='black' stroke-width='1' />
<line x1='1003.0' x2='1003.0' y1='0.0' y2='195.0' stroke='black' stroke-width='3' />
<text x='793' y='42' font-size='37' fill='black'>1</text>
<line x1='845.0' x2='859.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='894.0' x2='908.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
<line x1='943.0' x2='957.8' y1='29.5' y2='29.5' stroke='black' stroke-width='2' />
</g>
</g>
</svg>     <div id='addcomment' style='border:none; width:280px;position:absolute;visibility:hidden;background:none'>
     <button id='commentA' style='width:130px;height:30px;background:#FEFBEB;color:#27ae60;font-size:medium'>插入点评</button>
     </div>
     
     <div id='popview' style='border:none; width:280px;position:absolute;visibility:hidden;background:none'>
     <button id='loopA' style='width:80px;height:30px;background:#FEFBEB;color:#27ae60;font-size:medium'>Start||:</button>
     <button id='loopB' style='width:80px;height:30px;background:#FEFBEB;color:#c0392b;font-size:medium'>:||End</button>
     <button id='loopCancel' onclick='cancelLoopAB()' style='width:70px;height:30px;background:#FEFBEB;font-size:medium'>Cancel</button>
     </div>
<script>
 document.documentElement.style.webkitTouchCallout='none'; document.documentElement.style.webkitUserSelect='none'; var meas_start=0; var line_num=1;var lines=[
{'staves':2},]
var meas_pos=[
{'line':0,'liney':106.4, 'notes':[155,],'pos':{'x':155,'y':-23,'w':194,'h':241},'page':0},
{'line':0,'liney':106.4, 'notes':[372,],'pos':{'x':372,'y':-23,'w':189,'h':241},'page':0},
{'line':0,'liney':106.4, 'notes':[584,],'pos':{'x':584,'y':-23,'w':189,'h':241},'page':0},
{'line':0,'liney':106.4, 'notes':[796,],'pos':{'x':796,'y':-23,'w':197,'h':241},'page':0},
];var page_pos=null;</script>
<script>window.pageBackColor='white';window.pageWidth='1056';</script>
<script>
//document.onclick=function(ev){
//    var oEvent=ev||event;
//    var oLeft=oEvent.clientX+'px';
//    var oTop=oEvent.clientY+'px'
//    alert(oLeft+','+oTop)
//}

function hideProgressMM() {
    var elem=document.getElementById('progressBar');
    elem.style.visibility='hidden';
}
function displayProgressMM(mm,nn,percent) {
    var elem=document.getElementById('progressBar');
    elem.style.visibility='visible';
}

function showProgressMm1(mm,nn,percent) {
    var meas=meas_pos[mm-meas_start];
    var pos=meas.pos;
    var notes=meas.notes;
    var w=pos.w;
    var x=notes[nn];//+w*percent;
    if(nn<notes.length-1){
        x+=(notes[nn+1]-x)*percent;
    }else{
        x+=(pos.x+w-x)*percent;
    }
    var elem=document.getElementById('progressBar');
    elem.x.baseVal.value=x;
    elem.y.baseVal.value=pos.y;
    elem.width.baseVal.value=10;
    elem.height.baseVal.value=pos.h;
    elem.style.fill="rgb(153,205,248)";
}
function showProgressMm(mm,nn,percent) {
    var meas=meas_pos[mm-meas_start];
    var pos=meas.pos;
    var notes=meas.notes;
    var w=pos.w*window.scale;
    var x=notes[nn]*window.scale;//+w*percent;
    // var y=pos.y+meas.liney;
    var y=pos.y*window.scale+yOfLine(meas);
    
    if(nn<notes.length-1){
        x+=(notes[nn+1]-x)*percent;
    }else{
        x+=(pos.x+w-x)*percent;
    }
    if(page_pos && meas.page<page_pos.length) {
        x+=page_pos[meas.page].x;
        y+=page_pos[meas.page].y;
    }
    var elem=window.progressBarElem;
    if(!elem){
        window.progressBarElem=document.getElementById('progressBar');
        elem=window.progressBarElem;
        elem.style.fill="rgb(153,205,248)";
        elem.width.baseVal.value=10*window.scale;
    }
    //    var elem=document.getElementById('progressBar');
    elem.x.baseVal.value=x;
    elem.y.baseVal.value=y;
    //    elem.width.baseVal.value=10;
    elem.height.baseVal.value=pos.h*window.scale;
    //    elem.style.fill="rgb(153,205,248)";
    var screenh=document.body.clientHeight;
    if (y<window.pageYOffset+0 || y>window.pageYOffset+screenh*0.7) {
        var to=y-30;
        window.scrollTo(0,to);
    }
}
//turnpage
function showProgressLineMm(mm,nn,percent) {
    if (!window.lineoffset) {
        showProgressMm(mm,nn,percent);
        return;
    }
    var meas=meas_pos[mm-meas_start];
    var pos=meas.pos;
    var notes=meas.notes;
    var w=pos.w;
    var h=pos.h;
    var x=0;//notes[nn];//+w*percent;
    var y=pos.y;
    
    if(nn<notes.length){
        x=notes[nn];
        if(nn<notes.length-1) {
            x+=(notes[nn+1]-x)*percent;
        }else{
            x+=(pos.x+w-x)*percent;
        }
    }else{
        x=pos.x + w
    }
    
    if (window.scale) {
        x = x*window.scale
        y = y*window.scale
        h = h*window.scale
    }
    
    //    if(nn<notes.length-1){
    //        x=notes[nn];
    //        x+=(notes[nn+1]-x)*percent;
    //    }else{
    //        //x=notes[0];
    //        x=notes[notes.length-1]
    //        x+=(w-x)*percent;
    //    }
    
    var line=meas.line;
    var linePos=window.lineoffset[line];
    if(linePos) {
        x+=linePos.x;
        y+=linePos.y;
    }
    
    if(linePos && line<window.lineoffset.length-1) {
        var screenw=document.body.clientWidth;
        var screenx=document.body.clientleft;
        var pagesPerScreen = 2;
        if (screenw>=1920*2){
            pagesPerScreen = 4;
        }
        if(pagesPerScreen == 4){
            if(x<window.pageXOffset+screenw*0.25 || x>window.pageXOffset+screenw*0.75){
                //                if(x>window.pageXOffset+screenw*0.75) {
                //                    turnPage(1)
                //                }else{
                //                    turnPage(-1)
                //                }
                //                var to=0
                //                if(line>0){
                //                    linePos = window.lineoffset[line-1];
                //                    to=linePos.x;
                //                }
                //                window.scrollTo(to,0);
                //                if(x>window.pageXOffset+screenw*0.75) {
                //                    var curPage = currentPage();
                //                    showPageWithId(curPage+2, true);
                //                    showPageWithId(curPage+3, true);
                //                }
                
                var to=0
                if(line>0){
                    linePos = window.lineoffset[line-1];
                    to=linePos.x;
                }
                window.scrollTo(to,0);
            }
        }else {
            if(x<window.pageXOffset+0 || x>window.pageXOffset+screenw/2){
                
                //                if(x>window.pageXOffset+screenw/2) {
                //                    var curPage = currentPage();
                //                    showPageWithId(curPage+1, true);
                //                }
                
                var to=linePos.x;
                window.scrollTo(to,0);
            }
        }
        //        }else if((x>window.pageXOffset+1920/2+200 && pos.y>1080*0.6) ||
        //           x<window.pageXOffset || (x>screenw-400) || (screenw<2000 && x>1920/2))
        //        {
        //            var to=linePos.x;
        //            window.scrollTo(to,0);
        //        }
    }
    var elem=window.progressBarElem;
    if(!elem){
        window.progressBarElem=document.getElementById('progressBar');
        elem=window.progressBarElem;
        elem.style.fill="rgb(153,205,248)";
        elem.width.baseVal.value=10;
    }
    //    var elem=document.getElementById('progressBar');
    elem.x.baseVal.value=x;
    elem.y.baseVal.value=y;
    //    elem.width.baseVal.value=10;
    elem.height.baseVal.value=h;
    //    elem.style.fill="rgb(153,205,248)";
}
function showProgressBarXY(x,y) {
    var elem=window.progressBarElem;
    if(!elem){
        window.progressBarElem=document.getElementById('progressBar');
        elem=window.progressBarElem;
        elem.style.fill="rgb(153,205,248)";
        elem.width.baseVal.value=10;
    }
    //    var elem=document.getElementById('progressBar');
    elem.x.baseVal.value=x;
    elem.y.baseVal.value=y;
    //    elem.width.baseVal.value=10;
    //    elem.height.baseVal.value=pos.h;
}

function showProgressBar(x,y,w,h) {
    var elem=document.getElementById('progressBar');
    elem.setAttributeNS (null, 'x',x);
    elem.setAttributeNS (null, 'y',y);
    elem.setAttributeNS (null, 'width',w);
    elem.setAttributeNS (null, 'height',h);
    elem.setAttributeNS (null, 'style',"fill:rgb(153,205,248)");
}

function setElementColor(identify, color) {
    var elem=document.getElementById(identify);
    if(elem) {
        //        elem.setAttributeNS (null, 'style',"fill:"+color);
        elem.setAttributeNS (null, 'fill',color);
    }
}

function highlightMeasure(from,to) {
    for (var i = meas_start+meas_pos.length-1; i >= 0; i--) {
        var elem=document.getElementById('m'+i);
        if (to>from && i>=from && i<to) {
            console.log(elem);
            elem.style.fill="rgba(220, 220, 220, 0.4)";
        }else{
            elem.style.fill="rgba(0, 0, 0, 0)";
        }
    };
}

function informApp(msg){
     document.location=msg;
}

function touchedMeasure(x,y) {
    for(var mm=meas_pos.length-1;mm>=0;mm--) {
        var m_pos = meas_pos[mm - meas_start];
        var pos = m_pos.pos;
        var liney = yOfLine(m_pos);
        //var y = pos.y + liney;
        
        if(x>pos.x && x<pos.x+pos.w && y>liney && y<liney+pos.h){
            //            var notes=meas_pos[mm - meas_start].notes;
            //            var num=notes.length;
            //            var nn=0;
            //            if (num>0 && x>=notes[0]) {
            //                for (; nn < num; nn++) {
            //                    if (nn==num-1) {
            //                        break;
            //                    }else if (x>=notes[nn] && x<notes[nn+1]) {
            //                        break;
            //                    }
            //                };
            //            }
            //            showProgressMm(mm,nn,0);
            //            informApp("?clickmm="+mm+"&nn="+nn);
            //            showPopMenu(mm,nn,pos);
            return mm;
            break;
        }
    }
    return -1;
}

function clickDocument(event){
    var ev=event || window.event;
    if (ev.target.nodeName == "BUTTON") {
        return;
    }
    //highlightMeasure(mm);
    var x=0;
    var y=0;//ev.offsetY;
    /*
     if (event.touches && event.touches.length >1) {
     var touch = event.touches[0];
     x=touch.pageX;
     y=touch.pageY;
     var mm1=touchedMeasure(x,y);
     if(mm1>=0){
     touch = event.touches[0];
     x=touch.pageX;
     y=touch.pageY;
     mm2=touchedMeasure(x,y);
     if(mm2>=0){
     var pos = meas_pos[mm1 - meas_start].pos;
     showLoopCursor(popview, true,pos.x-20,pos.y,pos.h);
     informApp("?loopa="+mm1);
     
     pos = meas_pos[mm2 - meas_start].pos;
     showLoopCursor(popview, false,pos.x+pos.w+15,pos.y,pos.h);
     // alert(mm);
     informApp("?loopb="+mm2);
     return;
     }
     }
     }else*/
    if (ev.touches && ev.touches.length > 0) {
        var touch = ev.touches[0];
        x=touch.pageX/window.scale;
        y=touch.pageY;
        // 把元素放在手指所在的位置
        //        showMessage(" x="+touch.pageX+" y="+touch.pageY+" x="+touch.clientX+" y="+touch.clientY,100,450);
    }else{
        //        showMessage("event.touches.length="+event.touches.length,200,100);
        x=ev.pageX/window.scale;
        y=ev.pageY;
    }
    
    var mm=touchedMeasure(x,y);
    if(mm>=0) {
        var notes=meas_pos[mm - meas_start].notes;
        var num=notes.length;
        var nn=0;
        if (num>0 && x>=notes[0]) {
            for (; nn < num; nn++) {
                if (nn==num-1) {
                    break;
                }else if (x>=notes[nn] && x<notes[nn+1]) {
                    break;
                }
            };
        }
        showProgressMm(mm,nn,0);
        informApp("?clickmm="+mm+"&nn="+nn);
        showPopMenu(mm,nn);
    }
}
function initload (){
    //document.onclick=clickDocument;
    document.addEventListener('touchstart',clickDocument, false);
    //document.addEventListener('touchend',clickDocument, false);
}
initload();
//document.touchend=clickDocument;

var hiddenPopviewTimer = null;

function clickMm(mm) {
}
function clickMeasure(mm) {
    var ev=event || window.event;
    //highlightMeasure(mm);
    var x=ev.offsetX;
    var y=ev.offsetY;
    var pos = meas_pos[mm - meas_start].pos;
    var notes=meas_pos[mm - meas_start].notes;
    var num=notes.length;
    var nn=0;
    if (num>0 && x>=notes[0]) {
        for (; nn < num; nn++) {
            if (nn==num-1) {
                break;
            }else if (x>=notes[nn] && x<notes[nn+1]) {
                break;
            }
        };
    }
    //alert("?clickmm="+mm+"&nn="+nn);
    //document.location="?clickmm="+mm+"&nn="+nn;
    showProgressMm(mm,nn,0);
    informApp("?clickmm="+mm+"&nn="+nn);
    showPopMenu(mm,nn);
}

function yOfLine(m_pos) {
    var liney = m_pos.liney
    if (window.lineoffset) {
        var line = m_pos.line;
        var linePos=window.lineoffset[line];
        if(linePos) {
            liney = linePos.y;
        }
    }
    return liney
}

function showPopMenu(mm,nn) {
    var m_pos = meas_pos[mm - meas_start];
    var pos = meas_pos[mm - meas_start].pos;
    //show pop view
    if(window.showTapButton=="comment") {
        var popview=document.getElementById("addcomment");
        if(!popview) {
            var xmlns = 'http://www.w3.org/2000/svg';
            popview=document.createElementNS(xmlns, 'div');
            document.body.appendChild (popview);
            popview.setAttributeNS (null, 'style','border:none; width:280px;position:absolute;visibility:hidden;background:none');
            popview.setAttributeNS (null, 'id','addcomment');
        }
        popview.style.visibility="visible";
        if(pos.x>1024-280) {
            popview.style.left=pos.x+pos.w-280;
        }else{
            popview.style.left=pos.x;
        }
        popview.style.top=pos.y-20;
        popview.value=mm;
        var loopA=document.getElementById("commentA");
        if(!loopA){
            var xmlns = 'http://www.w3.org/2000/svg';
            loopA=document.createElementNS(xmlns, 'button');
            document.body.appendChild (loopA);
            loopA.setAttributeNS (null, 'style','width:130px;height:30px;background:#FEFBEB;color:#27ae60;font-size:medium');
            loopA.setAttributeNS (null, 'id','commentA');
        }
        loopA.onclick=function(){
            // alert(mm+" "+pos.x+" "+pos.y+" "+pos.h);
            informApp("?commenta="+mm+"&nn="+nn);
            clearTimeout(hiddenPopviewTimer);
            popview.style.visibility='hidden';
        }
        if (hiddenPopviewTimer) {
            clearTimeout(hiddenPopviewTimer);
        };
        hiddenPopviewTimer = setTimeout("addcomment.style.visibility='hidden';", 6000);
        return;
    }
    if(window.showTapButton=="loopab") {
        var liney = yOfLine(m_pos)
        var popview=document.getElementById("popview");
        popview.style.visibility="visible";
        if(pos.x>1024-280) {
            popview.style.left=(pos.x+pos.w-280)*window.scale;
        }else{
            popview.style.left=pos.x*window.scale;
        }
        popview.style.top=pos.y+liney-20;
        popview.value=mm;
        var loopA=document.getElementById("loopA");
        loopA.onclick=function(){
            // alert(mm+" "+pos.x+" "+pos.y+" "+pos.h);
            showLoopCursor(popview, true,pos.x-20,pos.y*window.scale+liney,pos.h);
            informApp("?loopa="+mm);
        }
        var loopB=document.getElementById("loopB");
        loopB.onclick=function(){
            showLoopCursor(popview, false,pos.x+pos.w+0,pos.y*window.scale+liney,pos.h);
            // alert(mm);
            informApp("?loopb="+mm);
        }
        if (hiddenPopviewTimer) {
            clearTimeout(hiddenPopviewTimer);
        };
        hiddenPopviewTimer = setTimeout("popview.style.visibility='hidden';", 6000);
    }
}

function showLoopAB(mm,isStart) {
    var meas=meas_pos[mm-meas_start];
    var pos=meas.pos;
    //var notes=meas.notes;
    //var w=pos.w;
    //var x=notes[nn];//+w*percent;
    var y=pos.y;
    var x=pos.x;
    //    if (!isStart){
    //        x+=pos.w;
    //    }
    
    var line=meas.line;
    var linePos=window.lineoffset[line];
    if(linePos) {
        x+=linePos.x;
        y+=linePos.y;
    }
    //    var pageLeft = page_pos[currentPage()];
    //    pos.x+=pageLeft.x;
    //    pos.y+=pageLeft.y;
    if(isStart){
        showLoopCursor(null, isStart, x-20, y, pos.h);
    }else{
        showLoopCursor(null, isStart, x+pos.w+15, y, pos.h);
    }
}

function showLoopCursor(popview, isStart,x,y,h) {
    var elem_id=(isStart)?'playloopA':'playloopB';
    var elem=document.getElementById(elem_id);
    elem.style.visibility='visible';
    elem.x.baseVal.value=x*window.scale;
    elem.y.baseVal.value=y;
    elem.width.baseVal.value=10*window.scale;
    elem.height.baseVal.value=h*window.scale;
    elem.style.fill=(isStart)?'#27ae60':'#c0392b';
    //elem.style.fill="rgb(153,205,248)";
    if(popview){
        clearTimeout(hiddenPopviewTimer);
        popview.style.visibility='hidden';
    }
}
function cancelLoopAB() {
    //alert('cancelLoopAB');
    var elem=document.getElementById('playloopA');
    elem.style.visibility='hidden';
    elem=document.getElementById('playloopB');
    elem.style.visibility='hidden';
    informApp("?loopc");
    
    var popview=document.getElementById("popview");
    clearTimeout(hiddenPopviewTimer);
    popview.style.visibility='hidden';
    highlightMeasure(0,0);
}

function removeAllTempNotes() {
    var c=document.getElementById('tempNoteGroup');
    if(c) {
        c.parentNode.removeChild(c);
    }
}

function removeAllFlags() {
    var c=document.getElementById('tempFlagsGroup');
    if(c) {
        c.parentNode.removeChild(c);
    }
}

function removeNoteLine(index) {
    var elem=document.getElementById('tempNote'+index);
    if (elem) {
        elem.parentNode.removeChild(elem);
    }
}

function addNote(index,x,y,style) {
    var elem=document.getElementById('tempNote'+index);
    if(elem==null){
        var xmlns = 'http://www.w3.org/2000/svg';
        var c=document.getElementById('svg');
        var noteGroup=document.createElementNS(xmlns, 'g');
        noteGroup.setAttributeNS(null, 'id','tempNoteGroup');
        c.appendChild(noteGroup);
        
        elem=document.createElementNS(xmlns, 'circle');
        noteGroup.appendChild (elem);
        //        c.appendChild(elem);
        
        elem.setAttributeNS (null, 'id','tempNote'+index);
    }
    elem.setAttributeNS (null, 'cx',x);
    elem.setAttributeNS (null, 'cy',y);
    elem.setAttributeNS (null, 'r','5');
    elem.setAttributeNS (null, 'style',style);
}
function addNoteLine(index, line,x,y,fillcolor) {
    var elem=document.getElementById('tempNote'+index);
    if(elem==null){
        var xmlns = 'http://www.w3.org/2000/svg';
        var noteGroup = document.getElementById('tempNoteGroup')
        if(noteGroup==null) {
            var c=document.getElementById('svg');
            var noteGroup=document.createElementNS(xmlns, 'g');
            noteGroup.setAttributeNS(null, 'id','tempNoteGroup');
            c.appendChild(noteGroup);
        }
        elem=document.createElementNS(xmlns, 'text');
        noteGroup.appendChild (elem);
        
        elem.setAttributeNS (null, 'id','tempNote'+index);
        elem.setAttributeNS (null, 'font-size','16');
        elem.setAttributeNS (null, 'style',"font-family: 'Aloisen New';");
        elem.textContent = "\u0174";
    }
    if(window.lineoffset && line<window.lineoffset.length) {
        var linePos=window.lineoffset[line];
        x+=linePos.x;
        y+=linePos.y;
    }
    elem.setAttributeNS (null, 'x',x);
    elem.setAttributeNS (null, 'y',y);
    elem.setAttributeNS (null, 'fill', fillcolor);
}
function showFlag(mm,nn,text) {
    var elem=document.getElementById('flags_'+mm+"_"+nn);
    if(elem==null){
        var xmlns = 'http://www.w3.org/2000/svg';
        var c=document.getElementById('svg');
        var noteGroup=document.getElementById('tempFlagsGroup');
        if(noteGroup==null){
            noteGroup = document.createElementNS(xmlns, 'g');
            noteGroup.setAttributeNS(null, 'id','tempFlagsGroup');
            c.appendChild(noteGroup);
        }
        
        elem=document.createElementNS(xmlns, 'circle');
        noteGroup.appendChild (elem);
        //        c.appendChild(elem);
        
        elem.setAttributeNS (null, 'id','flags_'+mm+"_"+nn);
    }
    elem.setAttributeNS (null, 'style',"fill:rgba(200, 100, 100, 0.8)");
    var notes=meas_pos[mm].notes;
    y=meas_pos[mm].pos.y-35;
    x=notes[nn];
    
    elem.setAttributeNS (null, 'cx',x);
    elem.setAttributeNS (null, 'cy',y);
    elem.setAttributeNS (null, 'r','10');
    
    text = text.replace(/kongge/ig, " ");
    text = text.replace(/huanhang/ig, "\n");
    
    elem.onclick=function(){
        showCommentMessage(text,mm,nn);
    }
}

function showCountDown(mm,nn,text) {
    var notes=meas_pos[mm].notes;
    y=meas_pos[mm].pos.y-50;
    x=notes[nn];
    var elem=document.getElementById('countdown');
    if (text==null) {
        if (elem) {
            elem.parentNode.removeChild(c);
        }
        return;
    }
    if(elem==null){
        var xmlns = 'http://www.w3.org/2000/svg';
        var c=document.getElementById('svg');
        elem=document.createElementNS(xmlns, 'text');
        c.appendChild (elem);
        elem.setAttributeNS (null, 'id','countdown');
        elem.setAttributeNS (null, 'text-anchor','middle');
        elem.setAttributeNS (null, 'font-size','50');
        elem.setAttributeNS (null, 'style','fill:rgb(0,0,200);');
    }
    
    elem.setAttributeNS (null, 'x',x);
    elem.setAttributeNS (null, 'y',y);
    var data = elem.lastChild;
    if(data==null){
        data = document.createTextNode('tt');
        elem.appendChild(data);
    }
   	data.textContent=text;
}

function showCommentMessage(text,mm,nn) {
    var notes=meas_pos[mm].notes;
    y=meas_pos[mm].pos.y-50;
    x=notes[nn];
    var elem=document.getElementById('comment');
    if(elem==null){
        var xmlns = 'http://www.w3.org/2000/svg';
        var c=document.getElementById('svg');
        elem=document.createElementNS(xmlns, 'text');
        c.appendChild (elem);
        elem.setAttributeNS (null, 'id','comment');
        elem.setAttributeNS (null, 'text-anchor','middle');
        elem.setAttributeNS (null, 'font-size','20');
        elem.setAttributeNS (null, 'style','fill:rgb(0,0,0);');
    }
    elem.setAttributeNS (null, 'x',x);
    elem.setAttributeNS (null, 'y',y);
    var data = elem.lastChild;
    if(data==null){
        data = document.createTextNode('tt');
        elem.appendChild(data);
        data.textContent=text;
    }else{
        elem.removeChild(data);
    }
}

function showVoiceFlag(mm,nn,voiceMessage) {
    var elem=document.getElementById('flags_'+mm+"_"+nn);
    if(elem==null){
        var xmlns = 'http://www.w3.org/2000/svg';
        var c=document.getElementById('svg');
        var noteGroup=document.createElementNS(xmlns, 'g');
        noteGroup.setAttributeNS(null, 'id','tempFlagsGroup');
        c.appendChild(noteGroup);
        
        elem=document.createElementNS(xmlns, 'circle');
        noteGroup.appendChild (elem);
        //        c.appendChild(elem);
        
        elem.setAttributeNS (null, 'id','flags_'+mm+"_"+nn);
    }
    elem.setAttributeNS (null, 'style',"fill:rgba(127, 255, 212, 0.8)");
    var notes=meas_pos[mm].notes;
    y=meas_pos[mm].pos.y-40;
    x=notes[nn];
    
    elem.setAttributeNS (null, 'cx',x);
    elem.setAttributeNS (null, 'cy',y);
    elem.setAttributeNS (null, 'r','10');
    
    //voice elem
    var voice=document.getElementById('audioPlay_'+mm+"_"+nn);
    if(voice==null){
        var c=document.getElementById('tempFlagsGroup');
        voice=document.createElement('audio');
        c.appendChild (voice);
        voice.setAttribute('id','audioPlay_'+mm+"_"+nn);
        voice.setAttribute('type', 'audio/caf');
    }
    voice.setAttribute('src',voiceMessage);
    
    elem.onclick=function(){
        var voice=document.getElementById('audioPlay_'+mm+"_"+nn);
        voice.play();
    }}

function showMessage(text,x,y) {
    var elem=document.getElementById('score');
    if(elem==null){
        var xmlns = 'http://www.w3.org/2000/svg';
        var c=document.getElementById('svg');
        elem=document.createElementNS(xmlns, 'text');
        c.appendChild (elem);
        elem.setAttributeNS (null, 'id','score');
        //        elem.setAttributeNS (null, 'text-anchor','middle');
        elem.setAttributeNS (null, 'font-size','25');
        elem.setAttributeNS (null, 'style','fill:rgb(100,200,10);');
    }
    elem.setAttributeNS (null, 'x',x);
    elem.setAttributeNS (null, 'y',y);
    var data = elem.lastChild;
    if(data==null){
        data = document.createTextNode('tt');
        elem.appendChild(data);
    }
    data.textContent=text;
}

function showScore(totalScore,x, score_y) {
    var elem=document.getElementById('score');
    if(elem==null){
        var xmlns = 'http://www.w3.org/2000/svg';
        var c=document.getElementById('svg');
        elem=document.createElementNS(xmlns, 'text');
        c.appendChild (elem);
        elem.setAttributeNS (null, 'id','score');
        elem.setAttributeNS (null, 'text-anchor','middle');
        elem.setAttributeNS (null, 'font-size','45');
        elem.setAttributeNS (null, 'style','fill:rgb(100,200,10);');
    }
    elem.setAttributeNS (null, 'x',x);
    elem.setAttributeNS (null, 'y',score_y);
    var data = elem.lastChild;
    if(data==null){
        data = document.createTextNode('tt');
        elem.appendChild(data);
    }
    data.textContent=totalScore;
}

function removeScore() {
    var elem=document.getElementById('score');
    if (elem && elem.parentNode) {
        elem.parentNode.removeChild(elem);
    }
}

function drawVelocities1(fromM, toM, velocities) {
    var count=0;
    var vel_count=velocities.length;
    var path="";
    var base_y,x;
    //    console.log("velocities:"+velocities);
    for (var m = fromM; m < toM && count<vel_count; m++) {
        var notes=meas_pos[m].notes;
        var len = notes.length;
        // console.log(notes);
        // console.log("len="+len);
        base_y=meas_pos[m].pos.y+50;
        for (var i = 0; i < len; i++) {
            // console.log("i:"+i);
            x=notes[i];
            var y=base_y-velocities[count];
            count++;
            path+="L"+x+","+y;
            // path+="Q"+(x-10)+","+y+" "+x+","+y;
            if (count<vel_count) {
                path+=" ";
            }else{
                break;
            }
        };
    };
    console.log(path);
    
    drawVelocityLine(fromM, path,x,base_y);
}

function drawVelocities(fromM, toM, velocities) {
    //var count=0;
    var vel_count=velocities.length;
    var path="";
    var base_y,x;
    //    console.log("velocities:"+velocities);
    for (var m = fromM; m < toM && m-fromM<vel_count; m++) {
        var notes=meas_pos[m].notes;
        var len = notes.length;
        var velsInMeasure = velocities[m-fromM];
        
        base_y=meas_pos[m].pos.y+50;
        for (var i = 0; i < len && i<velsInMeasure.length; i++) {
            // console.log("i:"+i);
            var v=velsInMeasure[i];
            if (v>0) {
                x=notes[i]+8;
                var y=base_y-velsInMeasure[i];
                path+="L"+x+","+y+" ";
            }
        };
    };
    //console.log(path);
    
    drawVelocityLine(fromM, path,x,base_y);
}

//path: q50,-100 100,0 q50,+50 100,0 q50,-20 100,0
function drawVelocityLine(fromM, path,end_x,base_y) {
    var elem=document.getElementById('vline_'+fromM);
    if (!elem) {
        var xmlns = 'http://www.w3.org/2000/svg';
        var c=document.getElementById('svg');
        elem=document.createElementNS(xmlns, 'path');
        elem.setAttributeNS(null, 'id','vline_'+fromM);
        elem.setAttributeNS(null, 'stroke','rgba(200, 200, 210, 0.8)');
        elem.setAttributeNS(null, 'stroke-width','2');
        elem.setAttributeNS(null, 'fill','rgba(200, 200, 210, 0.4)');
        c.appendChild(elem);
    }
    var pos1=meas_pos[fromM].pos;
    var newPath="M"+pos1.x+","+base_y+" "+path+" L"+end_x+","+base_y;
    elem.setAttributeNS(null, 'd',newPath);
    // alert(newPath);
}

function createPage(parent,index,x,y,w,h)
{
    createPageColor(parent,index,x,y,w,h, window.pageBackColor);
}
function createPageColor(parent,index,x,y,w,h, bgcolor)
{
    var pageElem=document.getElementById("page_"+index);
    if (!pageElem) {
        var xmlns = 'http://www.w3.org/2000/svg';
        var pageElem=document.createElementNS(xmlns, 'rect');
        pageElem.setAttributeNS(null, 'id', "page_"+index);
        if(bgcolor != "black"){
            if(index==0) {
                bgcolor = "#fff"
            }else {
                var i = index%4;
                if(i==1 || i==2) {
                    bgcolor = "#fff4d8"
                }else {
                    bgcolor = "#e9fffc"
                }
            }
        }
        pageElem.setAttributeNS (null, 'style','fill:'+bgcolor+';stroke:#AAA;stroke-width:0;');
        parent.appendChild(pageElem);
    }
    var scale = window.scale //w/1024
    pageElem.setAttributeNS (null, 'x',x+10*scale);
    pageElem.setAttributeNS (null, 'y',0);
    pageElem.setAttributeNS (null, 'width',w-30*scale);
    pageElem.setAttributeNS (null, 'height',h+160);
}
function pageNumber() {
    return page_pos.length
}
function setPageColor(page, color) {
    var pageElem=document.getElementById("page_"+page);
    if (pageElem) {
        pageElem.setAttributeNS (null, 'style','fill:'+color+';');
    }
}

function showPageWithId(index, show) {
    var elem=document.getElementById("page_"+index);
    if(elem){
        if(show) {
            elem.style.visibility='visible';
            //            elem.style.display='block';
        }else{
            elem.style.visibility='hidden';
            //            elem.style.display='none';
        }
    }
}

function setSvgPageSizeJianpu(lw,h,hormode)
{
    setSvgPageLineSize(lw,h,hormode,"JianpuLine_");
}

function showElemWithId(elemId, show) {
    var elem1=document.getElementById(elemId);
    if(elem1){
        if(show) {
            style='visibility:visible;'
        }else{
            style='visibility:hidden;'
        }
        elem1.setAttributeNS (null, 'style',style);
    }
}

function showJianpu(show) {
    showElemWithId('jianpu',show);
    showElemWithId('wuxianpu',!show);
}

function setSvgPageBackColor(color)
{
    window.pageBackColor=color;
}

function setSvgPageSize(lw,h,hormode)
{
    setSvgPageLineSize(lw,h,hormode,"line_");
    var svg = document.getElementById("svg");
    svg.setAttributeNS(null, 'style', "visibility:visible;");
}
//hormode: true: scroll from left to right. false: scroll from top to bottom
function setSvgPageLineSize(lw,h,hormode, linePrefix)
{
    var backElem=document.getElementById("tempgroup");
    
    if (!window.pageBackColor) {
        window.pageBackColor="#fff";
    }
    if (!window.pageWidth) {
        window.pageWidth=1024
    }
    
    var scale = lw/window.pageWidth
    window.scale = scale
    var x=0;
    var staffHeight=lw/8.0;
    if (!hormode) {
        staffHeight = lw/7.0;
    }
    var lineHeight=lw/4.1;//1024: 240
    if (h<1000) {
        lineHeight=lw/4.5;
    };
    var topMargin= lineHeight*0.4;//80;
    var y=topMargin;//lineHeight;
    // var w=1024;
    var pageY=10;//topMargin/4;
    var pageW=lw-10*scale;
    
    var titlePage=document.getElementById("page_title");
    titlePage.setAttributeNS(null,'transform',"translate(0, 0) scale("+scale+","+scale+")");
    
    var page=0;
    if (hormode) {
        page_pos=new Array();
        page_pos[page]={"x":0,"y":0};
        createPage(backElem,page,x,pageY,pageW,h);
        page++;
        //        var titlePage=document.getElementById("page_title");
        //        titlePage.setAttributeNS(null,'transform',"translate(0, 0) scale("+scale+","+scale+")");
        
        x+=lw;
        page_pos[page]={"x":x,"y":0};
        createPage(backElem,page,x,pageY,pageW,h);
        page++;
    }else{
        y+=180;
    }
    
    window.lineoffset=new Array();
    for (var i = 0; i < line_num; i++) {
        var staves=lines[i].staves;
        lineHeight = staffHeight * staves;
        
        window.lineoffset[i]={"x":x,"y":y};
        var lineElem=document.getElementById(linePrefix+i);
        lineElem.setAttributeNS(null,'transform',"translate("+x+", "+y+") scale("+scale+","+scale+")");
        if (i<line_num-1) {
            if (hormode) {
                // console.log('x='+x+' y='+y+' w='+w);
                if (y+1.6*lineHeight>h) {
                    y=topMargin;
                    x+=lw;
                    // w+=1024;
                    page_pos[page]={"x":x,"y":0};
                    createPage(backElem,page,x,pageY,pageW,h);
                    
                    page++;
                }else{
                    y+=lineHeight;
                }
            }else{
                y+=lineHeight;
            }
        }
    }
    // console.log('w='+w);
    y+=lineHeight;
    // w+=1024;
    
    var svgElem=document.getElementById("svg");
    if(hormode){
        //        if(page<4){
        x+=lw;
        page_pos[page]={"x":x,"y":0};
        createPage(backElem,page,x,pageY,pageW,h);
        page++;
        //        }
        if(page<4) {
            x+=lw;
            page_pos[page]={"x":x,"y":0};
            createPage(backElem,page,x,pageY,pageW,h);
            page++;
        }
        lw-=10;
        svgElem.setAttributeNS(null, 'width',x+lw+'px');
        svgElem.setAttributeNS(null, 'height',h+'px');
    }else{
        svgElem.setAttributeNS(null, 'width',lw+'px');
        svgElem.setAttributeNS(null, 'height',y+'px');
    }
    return page;
}

function currentPage() {
    for (var i = page_pos.length - 1; i >= 0; i--)
    {
        var curx=window.pageXOffset;
        var pagex=page_pos[i].x;
        if (curx>=pagex-80 && curx<pagex+300) {
            return i;
            break;
        }
    }
    return 0;
}

function movePage(num,pagex,delta)
{
    if(num != 0 )
    {
        var index = 0;
        var moveToX;
        if (delta>0) {
            moveToX = (pagex - document.body.clientWidth/4) + (11 - num) * document.body.clientWidth/4/10;
        }else{
            moveToX = (pagex + document.body.clientWidth/4) - (11 - num) * document.body.clientWidth/4/10;
        }
        index = num-1;
        window.scrollTo(moveToX,0);
        setTimeout("movePage("+index+","+pagex+","+delta+")",20);
    }
}
function turnPage(delta) {
    var move = 1;
    var curPage = currentPage();
    pagex=page_pos[curPage].x;
    if(pagex==0 && delta<0){
        move = 0;
    }
    var topage=curPage+delta;
    if (topage>page_pos.length - 1) {
        topage=page_pos.length - 1;
    }else if (topage<0) {
        topage=0;
    }
    //delta = delta;
    pagex=page_pos[topage].x;
    if(move!=0){
        setTimeout("movePage(10,"+pagex+","+delta+")",20);
    }
}
function setOnePage(width) {
    setSvgPageSize(width,1024,false);
    window.showTapButton="loopab";
    // var svg = document.getElementById("svg");
    // svg.setAttributeNS(null, 'style', "visibility:visible;");
}
//setOnePage(800)
//setSvgPageSize(340,340*16/9,true);
//setSvgPageSize(1440/2,1440*2/3,false);
//setSvgPageSizeJianpu(1920/2,1080*16/9,true);
//showJianpu(true);
//setSvgPageSize(1024,1024*4/3,true);

//document.body.style.overlfow='hidden';
//document.documentElement.style.overflow='hidden';
//setSvgPageSize(1920/2,1080,true);
//showProgressLineMm(11,0,0);

</script>
</body></html>
